# frontend/.docker/nginx/conf.d/default.conf

# Upstream fixo para o serviço "backend" do docker-compose
upstream backend_upstream {
    server backend:3000;   # troque para 3000 se o backend expõe 3000
    keepalive 32;
}

# Necessário para WebSocket/Socket.IO
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    listen 80;
    server_name _;

    root /var/www/public;
    index index.html index.htm;

    # SPA (React) – sempre entrega o index.html
    include /etc/nginx/include.d/spa.conf;

    # Proxy da API e do WebSocket
    location ~ ^/(api|socket\.io)/ {
        proxy_pass http://backend_upstream;
        include /etc/nginx/include.d/proxy.conf;
    }

    # Se não estiver usando HTTPS agora, deixe os includes abaixo comentados
    # include /etc/nginx/include.d/ssl-redirect.conf;
    # include /etc/nginx/include.d/ssl.conf;
}
